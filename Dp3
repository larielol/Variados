package helpers

import (
    "fmt"
    "io/ioutil"
    "log"
    "os"
    "path/filepath"
    "sync"
)

// Versão COM concorrência usando goroutines e channels
func generateFilesHashMapConcurrent(diretorio string) map[string][]int {
    if _, err := os.Stat(diretorio); os.IsNotExist(err) {
        log.Fatalf("O diretório %s não existe", diretorio)
    }

    files := listarArquivos(diretorio)
    result := make(map[string][]int)
    
    var wg sync.WaitGroup
    var mu sync.Mutex
    
    for _, name := range files {
        wg.Add(1)
        go func(filename string) {
            defer wg.Done()
            
            fp := filepath.Join(diretorio, filename)
            fileSum, err := sum(fp)
            if err != nil {
                fileSum = 0
            }
            
            mu.Lock()
            result[fp] = []int{fileSum}
            mu.Unlock()
        }(name)
    }
    
    wg.Wait()
    return result
}
